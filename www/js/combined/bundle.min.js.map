{"version":3,"sources":["bundle.min.js","app.js","controllers.js","directives.js","services.js"],"names":["lukkariApp","angular","module","run","$ionicPlatform","ready","window","cordova","plugins","Keyboard","hideKeyboardAccessoryBar","disableScroll","StatusBar","styleDefault","constant","url","config","$stateProvider","$urlRouterProvider","state","abstract","templateUrl","controller","views","menuContent","otherwise","lukkariControllers","$scope","$ionicLoading","LocalStorage","$ionicModal","MyDate","Lessons","getAppointments","show","template","getDay","day","currentDay","callback","response","hide","success","lessons","dayLessons","console","log","groupInfo","group","get","Date","fromTemplateUrl","scope","then","modal","closeGroupName","setGroup","set","changeGroup","groupName","undefined","moveDay","direction","getDayFromDay","offsetDays","$stateParams","lesson","getLesson","id","getWeek","currentDate","allLessons","weekLessons","length","days","i","date","lessonsLength","j","startDay","toDateString","push","getMonday","endDate","moveWeek","$cordovaToast","$timeout","$cordovaCalendar","datePickerCallback","val","reminder","datepickerObject","inputDate","datePickerCallback2","endDay","datepickerObject2","toastOptions","duration","position","titleLabel","todayLabel","closeLabel","setLabel","setButtonType","todayButtonType","closeButtonType","mondayFirst","templateType","showTodayButton","modalHeaderColor","modalFooterColor","from","dateFormat","closeOnSelect","time","e","location","href","addToCalendar","createEvent","element","index","array","groups","createEventWithOptions","title","name","room","notes","teacher","code","startDate","firstReminderMinutes","calOptions","secondReminderMinutes","calendarName","calendarId","result","err","getDayToDay","forEach","msg","lukkariDirectives","directive","lukkariServices","factory","localStorage","getItem","value","setItem","d","diff","getDate","setDate","getLocaleDate","_ref","years","options","month","year","Intl","DateTimeFormat","format","_ref2","getTime","DAY_IN_MILLISECONDS","setTime","getDayFromToday","now","$http","ApiEndpoint","parseLesson","resources","resource","type","roomInfo","parent","data","studentGroup","savedGroupName","apiKey","method","withCredentials","headers","authorization","accept-language","content-type","cache-control","status","reservations","error","_ref3","toUpperCase","_ref4","getMonth","_ref5","getFullYear","_ref6","correctEndDate","retLessons"],"mappings":"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","file":"bundle.min.js","sourcesContent":["'use strict';\n\nvar lukkariApp = angular.module('lukkari', ['ionic', 'lukkari.controllers', 'lukkari.services', 'lukkari.directives', 'ionic-datepicker']);\n\nlukkariApp.run(['$ionicPlatform', function ($ionicPlatform) {\n  $ionicPlatform.ready(function () {\n    // Hide the accessory bar by default (remove this to show the accessory bar above the keyboard\n    // for form inputs)\n    if (window.cordova && window.cordova.plugins.Keyboard) {\n      cordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);\n      cordova.plugins.Keyboard.disableScroll(true);\n    }\n    if (window.StatusBar) {\n      // org.apache.cordova.statusbar required\n      StatusBar.styleDefault();\n    }\n  });\n}]);\n\n// http://blog.ionic.io/handling-cors-issues-in-ionic/\nlukkariApp.constant('ApiEndpoint', {\n  url: 'https://opendata.tamk.fi/r1'\n});\n\n// menuContent-view is presented on the main view.\nlukkariApp.config(['$stateProvider', '$urlRouterProvider', function ($stateProvider, $urlRouterProvider) {\n  $stateProvider.state('app', {\n    url: '/app',\n    abstract: true,\n    templateUrl: 'templates/menu.html',\n    controller: 'LukkariCtrl'\n  }).state('app.search', {\n    url: '/search',\n    views: {\n      'menuContent': {\n        templateUrl: 'templates/search.html',\n        controller: 'SearchCtrl'\n      }\n    }\n  }).state('app.settings', {\n    url: '/settings',\n    views: {\n      'menuContent': {\n        templateUrl: 'templates/settings.html',\n        controller: 'SettingsCtrl'\n      }\n    }\n  }).state('app.todayLesson', {\n    url: '/today/:id',\n    views: {\n      'menuContent': {\n        templateUrl: 'templates/lesson.html',\n        controller: 'LessonCtrl'\n      }\n    }\n  }).state('app.today', {\n    url: '/today',\n    views: {\n      'menuContent': {\n        templateUrl: 'templates/today.html',\n        controller: 'TodayCtrl'\n      }\n    }\n  }).state('app.lesson', {\n    url: '/week/:id',\n    views: {\n      'menuContent': {\n        templateUrl: 'templates/lesson.html',\n        controller: 'LessonCtrl'\n      }\n    }\n  }).state('app.week', {\n    url: '/week',\n    views: {\n      'menuContent': {\n        templateUrl: 'templates/week.html',\n        controller: 'WeekCtrl'\n      }\n    }\n  });\n  // if none of the above states are matched, use this as the fallback\n  $urlRouterProvider.otherwise('/app/today');\n}]);\n'use strict';\n\nvar lukkariControllers = angular.module('lukkari.controllers', ['ngCordova']);\n\n// insert needed sidemenu stuff here\nlukkariControllers.controller('LukkariCtrl', [function ($scope) {}]);\n\n// controller for today view\nlukkariControllers.controller('TodayCtrl', ['$scope', '$ionicLoading', 'LocalStorage', '$ionicModal', 'MyDate', 'Lessons', function ($scope, $ionicLoading, LocalStorage, $ionicModal, MyDate, Lessons) {\n  $scope.groupInfo = {};\n  $scope.groupInfo.group = LocalStorage.get('groupName');\n  $scope.currentDay = new Date();\n\n  // Show new group modal when no group is set\n  $ionicModal.fromTemplateUrl('templates/newgroup.html', {\n    scope: $scope\n  }).then(function (modal) {\n    $scope.modal = modal;\n    if (!$scope.groupInfo.group) {\n      // open modal to set group name\n      $scope.modal.show();\n    }\n  });\n\n  $scope.closeGroupName = function () {\n    $scope.modal.hide();\n  };\n\n  function getAppointments() {\n    $ionicLoading.show({\n      template: 'Loading...'\n    });\n\n    Lessons.getDay({\n      day: $scope.currentDay,\n      callback: function callback(response) {\n        $ionicLoading.hide();\n        if (!response.success) {\n          console.log('ERROR');\n        } else {\n          $scope.lessons = response.dayLessons;\n        }\n      }\n    });\n  }\n\n  // sets the group\n  $scope.setGroup = function () {\n    LocalStorage.set('groupName', $scope.groupInfo.group);\n    $scope.modal.hide();\n\n    Lessons.changeGroup({\n      groupName: $scope.groupInfo.group,\n      callback: function callback(success) {\n        if (success) {\n          getAppointments();\n        } else {\n          console.log('failed to change group name');\n        }\n      }\n    });\n  };\n\n  $scope.lessons = [];\n  if ($scope.groupInfo.group !== undefined) {\n    Lessons.changeGroup({\n      groupName: $scope.groupInfo.group,\n      callback: function callback(success) {\n        if (success) {\n          getAppointments();\n        } else {\n          console.log('failed to change group name');\n        }\n      }\n    });\n  }\n\n  // Moves a day forwards/backwards\n  $scope.moveDay = function (direction) {\n    $scope.currentDay = MyDate.getDayFromDay({\n      currentDay: $scope.currentDay,\n      offsetDays: direction\n    });\n\n    getAppointments();\n  };\n}]);\n\n// controller for single appointment view\nlukkariControllers.controller('LessonCtrl', ['$scope', '$ionicLoading', '$stateParams', 'Lessons', function ($scope, $ionicLoading, $stateParams, Lessons) {\n  $scope.lesson = Lessons.getLesson($stateParams.id);\n}]);\n\n// controller for weekly view\nlukkariControllers.controller('WeekCtrl', ['$scope', '$ionicLoading', '$ionicModal', 'LocalStorage', 'MyDate', 'Lessons', function ($scope, $ionicLoading, $ionicModal, LocalStorage, MyDate, Lessons) {\n  $scope.groupInfo = {};\n  $scope.groupInfo.group = LocalStorage.get('groupName');\n  $scope.currentDate = MyDate.getMonday(new Date());\n  $scope.endDate = MyDate.getDayFromDay({\n    currentDay: $scope.currentDate,\n    offsetDays: 4\n  });\n\n  // Create modal for new group if no group name is set\n  if (!$scope.groupInfo.group) {\n    $ionicModal.fromTemplateUrl('templates/newgroup.html', {\n      scope: $scope\n    }).then(function (modal) {\n      $scope.modal = modal;\n      // open modal to set group name\n      $scope.modal.show();\n    });\n  }\n\n  // closes the group name dialog\n  $scope.closeGroupName = function () {\n    $scope.modal.hide();\n  };\n\n  // returns all of the appointments\n  function getAppointments() {\n    // show the loading window\n    $ionicLoading.show({\n      template: 'Loading...'\n    });\n    // get all the appointments\n    Lessons.getWeek({\n      day: $scope.currentDate,\n      callback: function callback(response) {\n        $ionicLoading.hide();\n        if (!response.success) {\n          console.log('ERROR');\n        } else {\n          var allLessons = response.weekLessons;\n          console.log(allLessons.length);\n          $scope.days = [];\n          for (var i = 0; i < 5; i++) {\n            var day = {};\n            // get mon-fri\n            day.date = MyDate.getDayFromDay({\n              currentDay: $scope.currentDate,\n              offsetDays: i\n            });\n            day.lessons = [];\n            var lessonsLength = allLessons.length;\n            for (var j = 0; j < lessonsLength; j++) {\n              var lesson = allLessons[j];\n              // if same day push into the day array\n              if (lesson.startDay.toDateString() === day.date.toDateString()) {\n                day.lessons.push(lesson);\n              }\n            }\n            $scope.days.push(day);\n          }\n        }\n      }\n    });\n    // hide the loading after done\n    $ionicLoading.hide();\n  }\n\n  // sets the group name\n  $scope.setGroup = function () {\n    LocalStorage.set('groupName', $scope.groupInfo.group);\n    $scope.modal.hide();\n\n    Lessons.changeGroup({\n      groupName: $scope.groupInfo.group,\n      callback: function callback(success) {\n        if (success) {\n          console.log('successfully changed group name');\n          getAppointments();\n        } else {\n          console.log('failed to change group name');\n        }\n      }\n    });\n  };\n\n  $scope.lessons = [];\n  if ($scope.groupInfo.group !== undefined) {\n    Lessons.changeGroup({\n      groupName: $scope.groupInfo.group,\n      callback: function callback(success) {\n        if (success) {\n          console.log('successfully changed group name');\n          getAppointments();\n        } else {\n          console.log('failed to change group name');\n        }\n      }\n    });\n  }\n\n  // moves a week forwards/backwards\n  $scope.moveWeek = function (direction) {\n    $scope.currentDate = MyDate.getDayFromDay({\n      currentDay: $scope.currentDate,\n      offsetDays: 7 * direction\n    });\n    $scope.endDate = MyDate.getDayFromDay({\n      currentDay: $scope.currentDate,\n      offsetDays: 4\n    });\n\n    getAppointments();\n  };\n}]);\n\nlukkariControllers.controller('SettingsCtrl', ['$scope', 'LocalStorage', '$cordovaToast', '$ionicPlatform', '$timeout', '$cordovaCalendar', 'Lessons', 'MyDate', function ($scope, LocalStorage, $cordovaToast, $ionicPlatform, $timeout, $cordovaCalendar, Lessons, MyDate) {\n  $scope.groupInfo = {};\n  $scope.reminder = {};\n  $scope.reminder.startDay = new Date();\n  $scope.reminder.endDay = new Date();\n\n  var toastOptions = {\n    duration: 'long',\n    position: 'center'\n  };\n\n  function datePickerCallback(val) {\n    if (typeof val === 'undefined') {\n      console.log('No date selected');\n    } else {\n      console.log('Selected date is : ', val);\n      $scope.reminder.startDay = val;\n      $scope.datepickerObject.inputDate = val;\n    }\n  }\n\n  function datePickerCallback2(val) {\n    if (typeof val === 'undefined') {\n      console.log('No date selected');\n    } else {\n      console.log('Selected date is : ', val);\n      $scope.reminder.endDay = val;\n      $scope.datepickerObject2.inputDate = val;\n    }\n  }\n\n  // https://github.com/rajeshwarpatlolla/ionic-datepicker\n  $scope.datepickerObject = {\n    titleLabel: 'Select Start Date', //Optional\n    todayLabel: 'Today', //Optional\n    closeLabel: 'Close', //Optional\n    setLabel: 'Set', //Optional\n    setButtonType: 'button-positive', //Optional\n    todayButtonType: 'button-stable', //Optional\n    closeButtonType: 'button-stable', //Optional\n    inputDate: $scope.reminder.startDay, //Optional\n    mondayFirst: true, //Optional\n    //disabledDates: disabledDates, //Optional\n    //weekDaysList: weekDaysList, //Optional\n    //monthList: monthList, //Optional\n    templateType: 'popup', //Optional\n    showTodayButton: 'true', //Optional\n    modalHeaderColor: 'bar-stable', //Optional\n    modalFooterColor: 'bar-stable', //Optional\n    from: new Date(), //Optional\n    //to: new Date(2018, 8, 25), //Optional\n    callback: function callback(val) {\n      //Mandatory\n      datePickerCallback(val);\n    },\n    dateFormat: 'dd-MM-yyyy', //Optional\n    closeOnSelect: true };\n\n  //Optional\n  $scope.datepickerObject2 = {\n    titleLabel: 'Select End Date', //Optional\n    todayLabel: 'Today', //Optional\n    closeLabel: 'Close', //Optional\n    setLabel: 'Set', //Optional\n    setButtonType: 'button-positive', //Optional\n    todayButtonType: 'button-stable', //Optional\n    closeButtonType: 'button-stable', //Optional\n    inputDate: $scope.reminder.endDay, //Optional\n    mondayFirst: true, //Optional\n    //disabledDates: disabledDates, //Optional\n    //weekDaysList: weekDaysList, //Optional\n    //monthList: monthList, //Optional\n    templateType: 'popup', //Optional\n    showTodayButton: 'true', //Optional\n    modalHeaderColor: 'bar-stable', //Optional\n    modalFooterColor: 'bar-stable', //Optional\n    from: new Date(), //Optional\n    //to: new Date(2018, 8, 25), //Optional\n    callback: function callback(val) {\n      //Mandatory\n      datePickerCallback2(val);\n    },\n    dateFormat: 'dd-MM-yyyy', //Optional\n    closeOnSelect: true };\n\n  //Optional\n  $scope.reminder.time = 'null';\n  $scope.groupInfo.group = LocalStorage.get('groupName');\n  if (!$scope.groupInfo.group) {\n    $scope.groupInfo.group = '';\n  }\n\n  $scope.changeGroup = function () {\n    LocalStorage.set('groupName', $scope.groupInfo.group);\n    // show toast that change was successful\n    $ionicPlatform.ready(function () {\n      try {\n        $cordovaToast.show('Group successfully changed!', toastOptions.duration, toastOptions.position);\n      } catch (e) {\n        // do nothing because it fails on browser\n      } finally {\n        // change to today view after 2 seconds\n        $timeout(function () {\n          window.location.href = '#/app/today';\n        }, 2000);\n      }\n    });\n  };\n\n  $scope.addToCalendar = function () {\n    var appointments = [];\n    var calOptions = {};\n    // works on iOS only\n    calOptions.calendarName = 'Lukkari app calendar';\n    // android has id but no fucking idea what it does (1 is default)\n    // so great documentation 5/5\n    // https://github.com/EddyVerbruggen/Calendar-PhoneGap-Plugin\n    calOptions.calendarId = 1;\n\n    // google may set some default reminders depending on settings\n    // https://github.com/EddyVerbruggen/Calendar-PhoneGap-Plugin/issues/201\n    if ($scope.reminder.time !== 'null') {\n      calOptions.firstReminderMinutes = $scope.reminder.time;\n    } else {\n      calOptions.firstReminderMinutes = null;\n    }\n    calOptions.secondReminderMinutes = null;\n\n    var success = true;\n\n    function createEvent(element, index, array) {\n      var groups = '';\n      for (var i = 0; i < element.groups.length; i++) {\n        groups += element.groups[i] + ', ';\n      }\n\n      $cordovaCalendar.createEventWithOptions({\n        title: element.name,\n        location: element.room,\n        notes: 'Teacher(s): ' + element.teacher + '\\nGroup(s): ' + groups + '\\nCourse: ' + element.code,\n        startDate: element.startDay,\n        endDate: element.endDay,\n        firstReminderMinutes: calOptions.firstReminderMinutes,\n        secondReminderMinutes: calOptions.secondReminderMinutes,\n        calendarName: calOptions.calendarName,\n        calendarId: calOptions.calendarId\n        //calOptions: calOptions\n      }).then(function (result) {}, function (err) {\n        success = false;\n      });\n    }\n\n    Lessons.getDayToDay({\n      startDate: $scope.reminder.startDay,\n      endDate: $scope.reminder.endDay,\n      callback: function callback(response) {\n        $ionicPlatform.ready(function () {\n          response.lessons.forEach(createEvent);\n        });\n      }\n    });\n    var msg = '';\n    if (success) {\n      msg = 'Calendar events successfully added!';\n    } else {\n      msg = 'Failed to add calendar events!';\n    }\n\n    $cordovaToast.show(msg, toastOptions.duration, toastOptions.position);\n    console.log(msg);\n  };\n}]);\n\n// TODO\nlukkariControllers.controller('SearchCtrl', ['$scope', 'LocalStorage', function ($scope, LocalStorage) {}]);\n'use strict';\n\nvar lukkariDirectives = angular.module('lukkari.directives', []);\n\nlukkariDirectives.directive('timeRange', function () {\n  return {\n    template: '{{lesson.startDay.toLocaleTimeString' + '(\"fi-FI\", {hour:\"numeric\", minute:\"numeric\"})}}' + ' — ' + '{{lesson.endDay.toLocaleTimeString' + '(\"fi-FI\", {hour:\"numeric\", minute:\"numeric\"})}}'\n  };\n});\n\nlukkariDirectives.directive('date', function () {\n  return {\n    template: '{{day.date.toLocaleDateString(\"fi-FI\",' + ' {weekday: \"short\", day: \"numeric\", month:\"numeric\"})}}'\n  };\n});\n'use strict';\n\nvar lukkariServices = angular.module('lukkari.services', []);\n\nlukkariServices.factory('LocalStorage', [function () {\n  function get(name) {\n    return window.localStorage.getItem(name);\n  }\n\n  function set(name, value) {\n    return window.localStorage.setItem(name, value);\n  }\n\n  return {\n    get: get,\n    set: set\n  };\n}]);\n\nlukkariServices.factory('MyDate', [function () {\n  var DAY_IN_MILLISECONDS = 86400000;\n\n  // returns the monday of the week date object of the given date\n  function getMonday(d) {\n    d = new Date(d);\n    var day = d.getDay();\n    var diff = d.getDate() - day + (day === 0 ? -6 : 1); // adjust when day is sunday\n    return new Date(d.setDate(diff));\n  }\n\n  function getLocaleDate(_ref) {\n    var day = _ref.day;\n    var years = _ref.years;\n\n    var options = {\n      //weekday: 'long',\n      month: 'numeric',\n      day: 'numeric'\n    };\n    if (typeof years === 'boolean' && years) {\n      options.year = 'numeric';\n    }\n    return new Intl.DateTimeFormat('fi-FI', options).format(day);\n  }\n\n  function getDayFromDay(_ref2) {\n    var currentDay = _ref2.currentDay;\n    var offsetDays = _ref2.offsetDays;\n\n    var day = currentDay.getTime();\n    // add desired amount of days to the millisecs\n    day += offsetDays * DAY_IN_MILLISECONDS;\n    // create Date object and set it's time to the millisecs\n    var date = new Date();\n    date.setTime(day);\n    return date;\n  }\n\n  // returns a day that is offset from today\n  function getDayFromToday(offsetDays) {\n    // today in millisecs since the beginning of time (UNIX time)\n    var day = Date.now();\n    // add desired amount of days to the millisecs\n    day += offsetDays * DAY_IN_MILLISECONDS;\n    // create Date object and set it's time to the millisecs\n    return new Date(day);\n  }\n\n  return {\n    getMonday: getMonday,\n    getDayFromToday: getDayFromToday,\n    getLocaleDate: getLocaleDate,\n    getDayFromDay: getDayFromDay\n  };\n}]);\n\nlukkariServices.factory('Lessons', ['$http', 'ApiEndpoint', 'MyDate', function ($http, ApiEndpoint, MyDate) {\n  var lessons = [];\n  var savedGroupName = '';\n\n  function parseLesson(element, index, array) {\n    var lesson = {};\n    lesson.id = index;\n    lesson.startDay = new Date(element.startDate);\n    lesson.endDay = new Date(element.endDate);\n    lesson.groups = [];\n    // parse the resources array\n    var resources = element.resources;\n\n    resources.forEach(function (resource, index, array) {\n      switch (resource.type) {\n        case 'realization':\n          lesson.code = resource.code;\n          lesson.name = resource.name;\n          break;\n        case 'room':\n          lesson.room = resource.code;\n          lesson.roomInfo = resource.parent.name;\n          break;\n        case 'student_group':\n          lesson.groups.push(resource.code);\n          break;\n      }\n    });\n    lessons.push(lesson);\n  }\n\n  function get(callback) {\n    var data = {\n      studentGroup: [savedGroupName]\n    };\n    var apiKey = 'Wu47zzKEPa7agvin47f5';\n    var url = ApiEndpoint.url + '/reservation/search' + '?apiKey=' + apiKey;\n    $http({\n      method: 'POST',\n      url: url,\n      data: data,\n      withCredentials: true,\n      headers: {\n        'authorization': 'Basic V3U0N3p6S0VQYTdhZ3ZpbjQ3ZjU6',\n        'accept-language': 'fi',\n        'content-type': 'application/json',\n        'cache-control': 'no-cache'\n      }\n    }).success(function (data, status, headers, config) {\n      console.log('success');\n      lessons = [];\n      data.reservations.forEach(parseLesson);\n      callback({\n        success: false\n      });\n    }).error(function (data, status, headers, config) {\n      console.log('failure');\n      callback({\n        success: false\n      });\n    });\n  }\n\n  // private get method that just saves lessons\n  // change group name method that changes group anme and uses private get method\n  function changeGroup(_ref3) {\n    var groupName = _ref3.groupName;\n    var callback = _ref3.callback;\n\n    savedGroupName = groupName.toUpperCase();\n    get(function (result) {\n      callback(result);\n    });\n  }\n\n  // get day method that returns one day's lessons using date\n  function getDay(_ref4) {\n    var callback = _ref4.callback;\n    var day = _ref4.day;\n\n    if (!day || !day instanceof Date) {\n      console.error('Error in date!');\n      callback({\n        success: false\n      });\n    } else {\n      var dayLessons = [];\n      lessons.forEach(function (lesson, index, array) {\n        var date = lesson.startDay;\n        if (date.getDate() === day.getDate() && date.getMonth() === day.getMonth()) {\n          dayLessons.push(lesson);\n        }\n      });\n      callback({\n        success: true,\n        dayLessons: dayLessons\n      });\n    }\n  }\n\n  // get week method that returns one week's lessons using startDate and week offset\n  function getWeek(_ref5) {\n    var callback = _ref5.callback;\n    var day = _ref5.day;\n\n    var weekLessons = [];\n    var startDate = new Date(day.getFullYear(), day.getMonth(), day.getDate());\n    var endDate = MyDate.getDayFromDay({\n      currentDay: day,\n      offsetDays: 5\n    });\n    lessons.forEach(function (lesson, index, array) {\n      if (lesson.startDay >= startDate && lesson.startDay <= endDate) {\n        weekLessons.push(lesson);\n      }\n    });\n    callback({\n      success: true,\n      weekLessons: weekLessons\n    });\n  }\n\n  //get day to day method that returns all appointments from day a to day b\n  function getDayToDay(_ref6) {\n    var callback = _ref6.callback;\n    var startDate = _ref6.startDate;\n    var endDate = _ref6.endDate;\n\n    var correctEndDate = MyDate.getDayFromDay({\n      currentDay: endDate,\n      offsetDays: 1\n    });\n    var retLessons = [];\n    lessons.forEach(function (lesson, index, array) {\n      if (lesson.startDay >= startDate && lesson.startDay <= correctEndDate) {\n        retLessons.push(lesson);\n      }\n    });\n    callback({\n      success: true,\n      lessons: retLessons\n    });\n  }\n\n  function getLesson(id) {\n    return lessons[id];\n  }\n\n  return {\n    changeGroup: changeGroup,\n    getDay: getDay,\n    getWeek: getWeek,\n    getDayToDay: getDayToDay,\n    getLesson: getLesson\n  };\n}]);","var lukkariApp = angular.module('lukkari', ['ionic', 'lukkari.controllers',\r\n  'lukkari.services', 'lukkari.directives', 'ionic-datepicker'\r\n]);\r\n\r\nlukkariApp.run(['$ionicPlatform',\r\nfunction($ionicPlatform) {\r\n  $ionicPlatform.ready(function() {\r\n    // Hide the accessory bar by default (remove this to show the accessory bar above the keyboard\r\n    // for form inputs)\r\n    if (window.cordova && window.cordova.plugins.Keyboard) {\r\n      cordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);\r\n      cordova.plugins.Keyboard.disableScroll(true);\r\n\r\n    }\r\n    if (window.StatusBar) {\r\n      // org.apache.cordova.statusbar required\r\n      StatusBar.styleDefault();\r\n    }\r\n  });\r\n}]);\r\n\r\n// http://blog.ionic.io/handling-cors-issues-in-ionic/\r\nlukkariApp.constant('ApiEndpoint', {\r\n  url: 'https://opendata.tamk.fi/r1'\r\n});\r\n\r\n// menuContent-view is presented on the main view.\r\nlukkariApp.config(['$stateProvider', '$urlRouterProvider',\r\n function($stateProvider, $urlRouterProvider) {\r\n  $stateProvider\r\n    .state('app', {\r\n      url: '/app',\r\n      abstract: true,\r\n      templateUrl: 'templates/menu.html',\r\n      controller: 'LukkariCtrl'\r\n    })\r\n    .state('app.search', {\r\n      url: '/search',\r\n      views: {\r\n        'menuContent': {\r\n          templateUrl: 'templates/search.html',\r\n          controller: 'SearchCtrl'\r\n        }\r\n      }\r\n    })\r\n    .state('app.settings', {\r\n      url: '/settings',\r\n      views: {\r\n        'menuContent': {\r\n          templateUrl: 'templates/settings.html',\r\n          controller: 'SettingsCtrl'\r\n        }\r\n      }\r\n    })\r\n    .state('app.todayLesson', {\r\n      url: '/today/:id',\r\n      views: {\r\n        'menuContent': {\r\n          templateUrl: 'templates/lesson.html',\r\n          controller: 'LessonCtrl'\r\n        }\r\n      }\r\n    })\r\n    .state('app.today', {\r\n      url: '/today',\r\n      views: {\r\n        'menuContent': {\r\n          templateUrl: 'templates/today.html',\r\n          controller: 'TodayCtrl'\r\n        }\r\n      }\r\n    })\r\n    .state('app.lesson', {\r\n      url: '/week/:id',\r\n      views: {\r\n        'menuContent': {\r\n          templateUrl: 'templates/lesson.html',\r\n          controller: 'LessonCtrl'\r\n        }\r\n      }\r\n    })\r\n    .state('app.week', {\r\n      url: '/week',\r\n      views: {\r\n        'menuContent': {\r\n          templateUrl: 'templates/week.html',\r\n          controller: 'WeekCtrl'\r\n        }\r\n      }\r\n    });\r\n  // if none of the above states are matched, use this as the fallback\r\n  $urlRouterProvider.otherwise('/app/today');\r\n}]);\r\n","var lukkariControllers = angular.module('lukkari.controllers', ['ngCordova']);\n\n// insert needed sidemenu stuff here\nlukkariControllers.controller('LukkariCtrl', [\n  function($scope) {}\n]);\n\n// controller for today view\nlukkariControllers.controller('TodayCtrl', ['$scope', '$ionicLoading',\n  'LocalStorage', '$ionicModal', 'MyDate', 'Lessons',\n  function($scope, $ionicLoading, LocalStorage, $ionicModal, MyDate,\n    Lessons) {\n    $scope.groupInfo = {};\n    $scope.groupInfo.group = LocalStorage.get('groupName');\n    $scope.currentDay = new Date();\n\n    // Show new group modal when no group is set\n    $ionicModal.fromTemplateUrl('templates/newgroup.html', {\n      scope: $scope\n    }).then(function(modal) {\n      $scope.modal = modal;\n      if (!$scope.groupInfo.group) {\n        // open modal to set group name\n        $scope.modal.show();\n      }\n    });\n\n    $scope.closeGroupName = function() {\n      $scope.modal.hide();\n    };\n\n    function getAppointments() {\n      $ionicLoading.show({\n        template: 'Loading...'\n      });\n\n      Lessons.getDay({\n        day: $scope.currentDay,\n        callback: function(response) {\n          $ionicLoading.hide();\n          if (!response.success) {\n            console.log('ERROR');\n          } else {\n            $scope.lessons = response.dayLessons;\n          }\n        }\n      });\n    }\n\n    // sets the group\n    $scope.setGroup = function() {\n      LocalStorage.set('groupName', $scope.groupInfo.group);\n      $scope.modal.hide();\n\n      Lessons.changeGroup({\n        groupName: $scope.groupInfo.group,\n        callback: function(success) {\n          if (success) {\n            getAppointments();\n          } else {\n            console.log('failed to change group name');\n          }\n        }\n      });\n    };\n\n    $scope.lessons = [];\n    if ($scope.groupInfo.group !== undefined) {\n      Lessons.changeGroup({\n        groupName: $scope.groupInfo.group,\n        callback: function(success) {\n          if (success) {\n            getAppointments();\n          } else {\n            console.log('failed to change group name');\n          }\n        }\n      });\n    }\n\n    // Moves a day forwards/backwards\n    $scope.moveDay = function(direction) {\n      $scope.currentDay = MyDate.getDayFromDay({\n        currentDay: $scope.currentDay,\n        offsetDays: direction\n      });\n\n      getAppointments();\n    };\n  }\n]);\n\n// controller for single appointment view\nlukkariControllers.controller('LessonCtrl', ['$scope', '$ionicLoading',\n  '$stateParams', 'Lessons',\n  function($scope, $ionicLoading, $stateParams, Lessons) {\n    $scope.lesson = Lessons.getLesson($stateParams.id);\n  }\n]);\n\n// controller for weekly view\nlukkariControllers.controller('WeekCtrl', ['$scope', '$ionicLoading',\n  '$ionicModal', 'LocalStorage', 'MyDate', 'Lessons',\n  function($scope, $ionicLoading, $ionicModal, LocalStorage, MyDate,\n    Lessons) {\n    $scope.groupInfo = {};\n    $scope.groupInfo.group = LocalStorage.get('groupName');\n    $scope.currentDate = MyDate.getMonday(new Date());\n    $scope.endDate = MyDate.getDayFromDay({\n      currentDay: $scope.currentDate,\n      offsetDays: 4\n    });\n\n    // Create modal for new group if no group name is set\n    if (!$scope.groupInfo.group) {\n      $ionicModal.fromTemplateUrl('templates/newgroup.html', {\n        scope: $scope\n      }).then(function(modal) {\n        $scope.modal = modal;\n        // open modal to set group name\n        $scope.modal.show();\n      });\n    }\n\n    // closes the group name dialog\n    $scope.closeGroupName = function() {\n      $scope.modal.hide();\n    };\n\n    // returns all of the appointments\n    function getAppointments() {\n      // show the loading window\n      $ionicLoading.show({\n        template: 'Loading...'\n      });\n      // get all the appointments\n      Lessons.getWeek({\n        day: $scope.currentDate,\n        callback: function(response) {\n          $ionicLoading.hide();\n          if (!response.success) {\n            console.log('ERROR');\n          } else {\n            var allLessons = response.weekLessons;\n            console.log(allLessons.length);\n            $scope.days = [];\n            for (var i = 0; i < 5; i++) {\n              var day = {};\n              // get mon-fri\n              day.date = MyDate.getDayFromDay({\n                currentDay: $scope.currentDate,\n                offsetDays: i\n              });\n              day.lessons = [];\n              var lessonsLength = allLessons.length;\n              for (var j = 0; j < lessonsLength; j++) {\n                var lesson = allLessons[j];\n                // if same day push into the day array\n                if (lesson.startDay.toDateString() ===\n                  day.date.toDateString()) {\n                  day.lessons.push(lesson);\n                }\n              }\n              $scope.days.push(day);\n            }\n          }\n        }\n      });\n      // hide the loading after done\n      $ionicLoading.hide();\n    }\n\n    // sets the group name\n    $scope.setGroup = function() {\n      LocalStorage.set('groupName', $scope.groupInfo.group);\n      $scope.modal.hide();\n\n      Lessons.changeGroup({\n        groupName: $scope.groupInfo.group,\n        callback: function(success) {\n          if (success) {\n            console.log('successfully changed group name');\n            getAppointments();\n          } else {\n            console.log('failed to change group name');\n          }\n        }\n      });\n    };\n\n    $scope.lessons = [];\n    if ($scope.groupInfo.group !== undefined) {\n      Lessons.changeGroup({\n        groupName: $scope.groupInfo.group,\n        callback: function(success) {\n          if (success) {\n            console.log('successfully changed group name');\n            getAppointments();\n          } else {\n            console.log('failed to change group name');\n          }\n        }\n      });\n    }\n\n    // moves a week forwards/backwards\n    $scope.moveWeek = function(direction) {\n      $scope.currentDate = MyDate.getDayFromDay({\n        currentDay: $scope.currentDate,\n        offsetDays: (7 * direction)\n      });\n      $scope.endDate = MyDate.getDayFromDay({\n        currentDay: $scope.currentDate,\n        offsetDays: 4\n      });\n\n      getAppointments();\n    };\n  }\n]);\n\nlukkariControllers.controller('SettingsCtrl', ['$scope', 'LocalStorage',\n  '$cordovaToast', '$ionicPlatform', '$timeout', '$cordovaCalendar',\n  'Lessons', 'MyDate',\n  function($scope, LocalStorage, $cordovaToast, $ionicPlatform,\n    $timeout, $cordovaCalendar, Lessons, MyDate) {\n    $scope.groupInfo = {};\n    $scope.reminder = {};\n    $scope.reminder.startDay = new Date();\n    $scope.reminder.endDay = new Date();\n\n    var toastOptions = {\n      duration: 'long',\n      position: 'center'\n    };\n\n    function datePickerCallback(val) {\n      if (typeof(val) === 'undefined') {\n        console.log('No date selected');\n      } else {\n        console.log('Selected date is : ', val);\n        $scope.reminder.startDay = val;\n        $scope.datepickerObject.inputDate = val;\n      }\n    }\n\n    function datePickerCallback2(val) {\n      if (typeof(val) === 'undefined') {\n        console.log('No date selected');\n      } else {\n        console.log('Selected date is : ', val);\n        $scope.reminder.endDay = val;\n        $scope.datepickerObject2.inputDate = val;\n      }\n    }\n\n    // https://github.com/rajeshwarpatlolla/ionic-datepicker\n    $scope.datepickerObject = {\n      titleLabel: 'Select Start Date', //Optional\n      todayLabel: 'Today', //Optional\n      closeLabel: 'Close', //Optional\n      setLabel: 'Set', //Optional\n      setButtonType: 'button-positive', //Optional\n      todayButtonType: 'button-stable', //Optional\n      closeButtonType: 'button-stable', //Optional\n      inputDate: $scope.reminder.startDay, //Optional\n      mondayFirst: true, //Optional\n      //disabledDates: disabledDates, //Optional\n      //weekDaysList: weekDaysList, //Optional\n      //monthList: monthList, //Optional\n      templateType: 'popup', //Optional\n      showTodayButton: 'true', //Optional\n      modalHeaderColor: 'bar-stable', //Optional\n      modalFooterColor: 'bar-stable', //Optional\n      from: new Date(), //Optional\n      //to: new Date(2018, 8, 25), //Optional\n      callback: function(val) { //Mandatory\n        datePickerCallback(val);\n      },\n      dateFormat: 'dd-MM-yyyy', //Optional\n      closeOnSelect: true, //Optional\n    };\n\n    $scope.datepickerObject2 = {\n      titleLabel: 'Select End Date', //Optional\n      todayLabel: 'Today', //Optional\n      closeLabel: 'Close', //Optional\n      setLabel: 'Set', //Optional\n      setButtonType: 'button-positive', //Optional\n      todayButtonType: 'button-stable', //Optional\n      closeButtonType: 'button-stable', //Optional\n      inputDate: $scope.reminder.endDay, //Optional\n      mondayFirst: true, //Optional\n      //disabledDates: disabledDates, //Optional\n      //weekDaysList: weekDaysList, //Optional\n      //monthList: monthList, //Optional\n      templateType: 'popup', //Optional\n      showTodayButton: 'true', //Optional\n      modalHeaderColor: 'bar-stable', //Optional\n      modalFooterColor: 'bar-stable', //Optional\n      from: new Date(), //Optional\n      //to: new Date(2018, 8, 25), //Optional\n      callback: function(val) { //Mandatory\n        datePickerCallback2(val);\n      },\n      dateFormat: 'dd-MM-yyyy', //Optional\n      closeOnSelect: true, //Optional\n    };\n\n    $scope.reminder.time = 'null';\n    $scope.groupInfo.group = LocalStorage.get('groupName');\n    if (!$scope.groupInfo.group) {\n      $scope.groupInfo.group = '';\n    }\n\n    $scope.changeGroup = function() {\n      LocalStorage.set('groupName', $scope.groupInfo.group);\n      // show toast that change was successful\n      $ionicPlatform.ready(function() {\n        try {\n          $cordovaToast.show('Group successfully changed!',\n            toastOptions.duration,\n            toastOptions.position);\n        } catch (e) {\n          // do nothing because it fails on browser\n        } finally {\n          // change to today view after 2 seconds\n          $timeout(function() {\n            window.location.href = '#/app/today';\n          }, 2000);\n        }\n      });\n    };\n\n    $scope.addToCalendar = function() {\n      var appointments = [];\n      var calOptions = {};\n      // works on iOS only\n      calOptions.calendarName = 'Lukkari app calendar';\n      // android has id but no fucking idea what it does (1 is default)\n      // so great documentation 5/5\n      // https://github.com/EddyVerbruggen/Calendar-PhoneGap-Plugin\n      calOptions.calendarId = 1;\n\n      // google may set some default reminders depending on settings\n      // https://github.com/EddyVerbruggen/Calendar-PhoneGap-Plugin/issues/201\n      if ($scope.reminder.time !== 'null') {\n        calOptions.firstReminderMinutes = $scope.reminder.time;\n      } else {\n        calOptions.firstReminderMinutes = null;\n      }\n      calOptions.secondReminderMinutes = null;\n\n      var success = true;\n\n      function createEvent(element, index, array) {\n        var groups = '';\n        for (var i = 0; i < element.groups.length; i++) {\n          groups += element.groups[i] + ', ';\n        }\n\n        $cordovaCalendar.createEventWithOptions({\n          title: element.name,\n          location: element.room,\n          notes: 'Teacher(s): ' + element.teacher +\n            '\\nGroup(s): ' + groups +\n            '\\nCourse: ' + element.code,\n          startDate: element.startDay,\n          endDate: element.endDay,\n          firstReminderMinutes: calOptions.firstReminderMinutes,\n          secondReminderMinutes: calOptions.secondReminderMinutes,\n          calendarName: calOptions.calendarName,\n          calendarId: calOptions.calendarId\n            //calOptions: calOptions\n        }).then(function(result) {\n        }, function(err) {\n          success = false;\n        });\n      }\n\n      Lessons.getDayToDay({\n        startDate: $scope.reminder.startDay,\n        endDate: $scope.reminder.endDay,\n        callback: function(response) {\n          $ionicPlatform.ready(function() {\n            response.lessons.forEach(createEvent);\n          });\n        }\n      });\n      var msg = '';\n      if (success) {\n        msg = 'Calendar events successfully added!';\n      } else {\n        msg = 'Failed to add calendar events!';\n      }\n\n      $cordovaToast.show(msg,\n        toastOptions.duration,\n        toastOptions.position);\n      console.log(msg);\n    };\n  }\n]);\n\n// TODO\nlukkariControllers.controller('SearchCtrl', ['$scope', 'LocalStorage',\n  function($scope, LocalStorage) {}\n]);\n","var lukkariDirectives = angular.module('lukkari.directives', []);\r\n\r\nlukkariDirectives.directive('timeRange', function() {\r\n  return {\r\n    template: '{{lesson.startDay.toLocaleTimeString' +\r\n    '(\"fi-FI\", {hour:\"numeric\", minute:\"numeric\"})}}' +\r\n    ' — ' +\r\n    '{{lesson.endDay.toLocaleTimeString' +\r\n    '(\"fi-FI\", {hour:\"numeric\", minute:\"numeric\"})}}'\r\n  };\r\n});\r\n\r\nlukkariDirectives.directive('date', function() {\r\n  return {\r\n    template: '{{day.date.toLocaleDateString(\"fi-FI\",' +\r\n    ' {weekday: \"short\", day: \"numeric\", month:\"numeric\"})}}'\r\n  };\r\n});\r\n","var lukkariServices = angular.module('lukkari.services', []);\n\nlukkariServices.factory('LocalStorage', [function() {\n  function get(name) {\n    return window.localStorage.getItem(name);\n  }\n\n  function set(name, value) {\n    return window.localStorage.setItem(name, value);\n  }\n\n  return {\n    get: get,\n    set: set\n  };\n}]);\n\nlukkariServices.factory('MyDate', [function() {\n  var DAY_IN_MILLISECONDS = 86400000;\n\n  // returns the monday of the week date object of the given date\n  function getMonday(d) {\n    d = new Date(d);\n    var day = d.getDay();\n    var diff = d.getDate() - day + (day === 0 ? -6 : 1); // adjust when day is sunday\n    return new Date(d.setDate(diff));\n  }\n\n  function getLocaleDate({\n    day, years\n  }) {\n    var options = {\n      //weekday: 'long',\n      month: 'numeric',\n      day: 'numeric'\n    };\n    if (typeof years === 'boolean' && years) {\n      options.year = 'numeric';\n    }\n    return new Intl.DateTimeFormat('fi-FI', options).format(day);\n  }\n\n  function getDayFromDay({\n    currentDay, offsetDays\n  }) {\n    var day = currentDay.getTime();\n    // add desired amount of days to the millisecs\n    day += offsetDays * DAY_IN_MILLISECONDS;\n    // create Date object and set it's time to the millisecs\n    var date = new Date();\n    date.setTime(day);\n    return date;\n  }\n\n  // returns a day that is offset from today\n  function getDayFromToday(offsetDays) {\n    // today in millisecs since the beginning of time (UNIX time)\n    var day = Date.now();\n    // add desired amount of days to the millisecs\n    day += offsetDays * DAY_IN_MILLISECONDS;\n    // create Date object and set it's time to the millisecs\n    return new Date(day);\n  }\n\n  return {\n    getMonday: getMonday,\n    getDayFromToday: getDayFromToday,\n    getLocaleDate: getLocaleDate,\n    getDayFromDay: getDayFromDay\n  };\n}]);\n\nlukkariServices.factory('Lessons', ['$http', 'ApiEndpoint','MyDate',\n  function($http, ApiEndpoint, MyDate) {\n    var lessons = [];\n    var savedGroupName = '';\n\n    function parseLesson(element, index, array) {\n      var lesson = {};\n      lesson.id = index;\n      lesson.startDay = new Date(element.startDate);\n      lesson.endDay = new Date(element.endDate);\n      lesson.groups = [];\n      // parse the resources array\n      var {\n        resources\n      } = element;\n      resources.forEach(function(resource, index, array) {\n        switch (resource.type) {\n          case 'realization':\n            lesson.code = resource.code;\n            lesson.name = resource.name;\n            break;\n          case 'room':\n            lesson.room = resource.code;\n            lesson.roomInfo = resource.parent.name;\n            break;\n          case 'student_group':\n            lesson.groups.push(resource.code);\n            break;\n        }\n      });\n      lessons.push(lesson);\n    }\n\n    function get(callback) {\n      var data = {\n        studentGroup: [savedGroupName]\n      };\n      var apiKey = 'Wu47zzKEPa7agvin47f5';\n      var url = ApiEndpoint.url + '/reservation/search' +\n        '?apiKey=' + apiKey;\n      $http({\n        method: 'POST',\n        url: url,\n        data: data,\n        withCredentials: true,\n        headers: {\n          'authorization': 'Basic V3U0N3p6S0VQYTdhZ3ZpbjQ3ZjU6',\n          'accept-language': 'fi',\n          'content-type': 'application/json',\n          'cache-control': 'no-cache'\n        }\n      }).success(function(data, status, headers, config) {\n        console.log('success');\n        lessons = [];\n        data.reservations.forEach(parseLesson);\n        callback({\n          success: false\n        });\n      }).error(function(data, status, headers, config) {\n        console.log('failure');\n        callback({\n          success: false\n        });\n      });\n    }\n\n    // private get method that just saves lessons\n    // change group name method that changes group anme and uses private get method\n    function changeGroup({\n      groupName, callback\n    }) {\n      savedGroupName = groupName.toUpperCase();\n      get(function(result) {\n        callback(result);\n      });\n    }\n\n    // get day method that returns one day's lessons using date\n    function getDay({\n      callback, day\n    }) {\n      if (!day || !day instanceof Date) {\n        console.error('Error in date!');\n        callback({\n          success: false\n        });\n      } else {\n        var dayLessons = [];\n        lessons.forEach(function(lesson, index, array) {\n          var date = lesson.startDay;\n          if (date.getDate() === day.getDate() &&\n            date.getMonth() === day.getMonth()) {\n            dayLessons.push(lesson);\n          }\n        });\n        callback({\n          success: true,\n          dayLessons\n        });\n      }\n    }\n\n    // get week method that returns one week's lessons using startDate and week offset\n    function getWeek({\n      callback, day\n    }) {\n      var weekLessons = [];\n      var startDate = new Date(day.getFullYear(), day.getMonth(),\n      day.getDate());\n      var endDate = MyDate.getDayFromDay({\n        currentDay: day,\n        offsetDays: 5\n      });\n      lessons.forEach(function(lesson, index, array) {\n        if (lesson.startDay >= startDate && lesson.startDay <= endDate) {\n          weekLessons.push(lesson);\n        }\n      });\n      callback({\n        success: true,\n        weekLessons\n      });\n    }\n\n    //get day to day method that returns all appointments from day a to day b\n    function getDayToDay({\n      callback, startDate, endDate\n    }) {\n      var correctEndDate = MyDate.getDayFromDay({\n        currentDay: endDate,\n        offsetDays: 1\n      });\n      var retLessons = [];\n      lessons.forEach(function(lesson, index, array) {\n        if (lesson.startDay >= startDate && lesson.startDay <= correctEndDate) {\n          retLessons.push(lesson);\n        }\n      });\n      callback({\n        success: true,\n        lessons: retLessons\n      });\n    }\n\n    function getLesson(id) {\n      return lessons[id];\n    }\n\n    return {\n      changeGroup: changeGroup,\n      getDay: getDay,\n      getWeek: getWeek,\n      getDayToDay: getDayToDay,\n      getLesson: getLesson\n    };\n  }\n]);\n"],"sourceRoot":"/source/"}
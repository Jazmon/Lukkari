"use strict";angular.module("jm.i18next").config(["$i18nextProvider",function(e){e.options={useCookie:!1,useLocalStorage:!0,fallbackLng:"en",resGetPath:"./locales/__lng__/__ns__.json",defaultLoadingValue:""}}]),angular.module("lukkari",["ionic","lukkari.controllers","lukkari.services","lukkari.directives","ionic-datepicker","ionic-material","jm.i18next"]).run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]).constant("ApiEndpoint",{url:"http://localhost:8100/api"}).constant("ApiKey",{key:"Wu47zzKEPa7agvin47f5"}).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("app",{url:"/app","abstract":!0,templateUrl:"templates/menu.html",controller:"LukkariCtrl"}).state("app.search",{url:"/search",views:{menuContent:{templateUrl:"templates/search.html",controller:"SearchCtrl"}}}).state("app.realization",{url:"/search/:code",views:{menuContent:{templateUrl:"templates/realization.html",controller:"RealizationCtrl"}}}).state("app.settings",{url:"/settings",views:{menuContent:{templateUrl:"templates/settings.html",controller:"SettingsCtrl"}}}).state("app.todayLesson",{url:"/today/:id",views:{menuContent:{templateUrl:"templates/lesson.html",controller:"LessonCtrl"}}}).state("app.today",{url:"/today",views:{menuContent:{templateUrl:"templates/today.html",controller:"TodayCtrl"}}}).state("app.lesson",{url:"/week/:id",views:{menuContent:{templateUrl:"templates/lesson.html",controller:"LessonCtrl"}}}).state("app.week",{url:"/week",views:{menuContent:{templateUrl:"templates/week.html",controller:"WeekCtrl"}}}).state("app.lunch",{url:"/lunch",views:{menuContent:{templateUrl:"templates/lunch.html",controller:"LunchCtrl"}}}),t.otherwise("/app/today")}]),angular.module("lukkari.services",[]),angular.module("lukkari.controllers",["ngCordova"]),angular.module("lukkari.directives",[]),angular.module("lukkari.services").factory("FoodService",["$http",function(e){function t(e,t,a){var o={};try{o.main=e.div[0].div.div.content,e.div.length>=2&&(o.side=e.div[1].div.div.content),e.div.length>=3&&(o.allergy=e.div[2].div.div.content)}catch(r){o.main=e.div.div.div.content}for(var i=!1,s=n.length;s--;)n[s].main.includes(o.main)&&(i=!0);i||n.push(o)}function a(a){var o=a.callback;n.length>0?o(n):e({method:"GET",url:["https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%","20html%20where%20url%3D%22http%3A%2F%2Fwww.campusravita.fi%2Fi","ntra_menu_today.php%22%20and%0A%20%20%20%20%20%20xpath%3D'%2F","%2Fdiv%5B%40class%3D%22rivitys-intra%22%5D'&format=json&diagn","ostics=true&callback="].join("")}).then(function(e){if(null===e.data.query.results)o(n);else{var a=e.data.query.results.div;a.forEach(t),o(n)}},function(e){})}var n=[];return{get:a}}]),angular.module("lukkari.services").factory("Lessons",["$http","ApiEndpoint","MyDate","ApiKey",function(e,t,a,n){function o(e,t,a){var n={};n.id=t,n.startDay=new Date(e.startDate),n.endDay=new Date(e.endDate),n.groups=[];var o=e.resources;o.forEach(function(e,t,a){switch(e.type){case"realization":n.code=e.code,n.name=e.name;break;case"room":n.room=e.code,n.roomInfo=e.parent.name;break;case"student_group":n.groups.push(e.code)}}),d.push(n)}function r(a){var r={studentGroup:[p]},i=[t.url,"/reservation/search","?apiKey=",n.key].join(""),s="en";navigator.language.includes("fi")&&(s="fi"),e({method:"POST",url:i,data:r,withCredentials:!0,headers:{authorization:"Basic V3U0N3p6S0VQYTdhZ3ZpbjQ3ZjU6","accept-language":s,"content-type":"application/json","cache-control":"no-cache"}}).success(function(e,t,n,r){d=[],e.reservations.forEach(o),a({success:!1})}).error(function(e,t,n,o){a({success:!1})})}function i(e){var t=e.groupName,a=e.callback;p=t.toUpperCase(),r(function(e){return a(e)})}function s(e){var t=e.callback,a=e.day;!a||!a instanceof Date?t({success:!1}):!function(){var e=function(e,t,o){var r=e.startDay;r.getDate()===a.getDate()&&r.getMonth()===a.getMonth()&&n.push(e)},n=[];d.forEach(e),t({success:!0,dayLessons:n})}()}function l(e){function t(e,t,a){e.startDay>=i&&e.startDay<=s&&r.push(e)}var n=e.callback,o=e.day,r=[],i=new Date(o.getFullYear(),o.getMonth(),o.getDate()),s=a.getDayFromDay({currentDay:o,offsetDays:5});d.forEach(t),n({success:!0,weekLessons:r})}function c(e){function t(e,t,a){e.startDay>=o&&e.startDay<=i&&s.push(e)}var n=e.callback,o=e.startDate,r=e.endDate,i=a.getDayFromDay({currentDay:r,offsetDays:1}),s=[];d.forEach(t),n({success:!0,lessons:s})}function u(e){return d[e]}var d=[],p=void 0;return{changeGroup:i,getDay:s,getWeek:l,getDayToDay:c,getLesson:u}}]),angular.module("lukkari.services").factory("LocalStorage",[function(){function e(e){var t=e.key;return window.localStorage.getItem(t)}function t(e){var t=e.key,a=e.value;return window.localStorage.setItem(t,a)}return{get:e,set:t}}]),angular.module("lukkari.services").factory("MyDate",[function(){function e(e){e=new Date(e);var t=e.getDay(),a=e.getDate()-t+(0===t?-6:1);return new Date(e.setDate(a))}function t(e){var t=e.day,a=e.years,n=e.weekday,o={month:"numeric",day:"numeric"};return o.year=a?"numeric":void 0,o.weekday=n?"long":void 0,new Intl.DateTimeFormat("fi-FI",o).format(t)}function a(e){var t=e.currentDay,a=e.offsetDays,n=t.getTime()+a*r,o=new Date;return o.setTime(n),o}function n(e){return a({currentDay:new Date,offsetDays:e})}function o(e){var t=e.date,a=e.minutes,n=e.hours,o=e.seconds,r=t;return n&&r.setHours(t.getHours()+n),a&&r.setMinutes(t.getMinutes()+a),o&&r.setSeconds(t.getSeconds()+o),r}var r=864e5;return{getMonday:e,getDayFromToday:n,getLocaleDate:t,getDayFromDay:a,offsetDate:o}}]),angular.module("lukkari.services").factory("Notifications",["LocalStorage","$ionicPlatform","$cordovaLocalNotification","Lessons","MyDate",function(e,t,a,n,o){function r(r){var i=r.use,s=r.timeOffset,l=JSON.parse(e.get({key:"notifications"}));t.ready(function(){i?(a.cancelAll().then(function(e){}),n.getWeek({day:new Date,callback:function(t){var n=t.weekLessons;n.forEach(function(t){var n=void 0;l?n=l[l.length-1]+1:(n=0,l=[]),l.push(n),e.set({key:"notifications",value:JSON.stringify(l)}),a.schedule({id:n,title:t.name,text:[t.room,", ",t.startDay.toLocaleTimeString(navigator.language,{hour:"numeric",minute:"numeric"})," - ",t.endDay.toLocaleTimeString(navigator.language,{hour:"numeric",minute:"numeric"})].join(""),at:o.offsetDate({date:t.startDay,minutes:s})})})}}),e.set({key:"useNotification",value:"true"})):(a.cancelAll(),e.set({key:"useNotification",value:"false"}))})}return{useNotifications:r}}]),angular.module("lukkari.services").factory("Search",["$http","ApiEndpoint","ApiKey",function(e,t,a){function n(n){var o=n.name,r=n.studentGroups,i=n.startDate,s=n.endDate,l=n.codes,c=n.successCallback,u=n.errorCallback,d=[t.url,"/realization/search","?apiKey=",a.key].join(""),p={};void 0!==o&&(p.name=o),void 0!==r&&(p.studentGroups=r),void 0!==i&&(p.startDate=i),void 0!==s&&(p.endDate=s),void 0!==l&&(p.codes=l);var m="en";navigator.language.includes("fi")&&(m="fi"),e({method:"POST",url:d,data:p,withCredentials:!0,headers:{authorization:"Basic V3U0N3p6S0VQYTdhZ3ZpbjQ3ZjU6","accept-language":m,"content-type":"application/json","cache-control":"no-cache"}}).success(function(e,t,a,n){c(e)}).error(function(e,t,a,n){u(t)})}return{search:n}}]),angular.module("lukkari.directives").directive("date",[function(){return{template:["{{day.date.toLocaleDateString(",navigator.language,",",' {weekday: "short", day: "numeric", month:"numeric"})}}'].join("")}}]),angular.module("lukkari.directives").directive("ngLastRepeat",["$timeout",function(e){return{restrict:"A",link:function(t,a,n){t.$last===!0&&e(function(){return t.$emit("ngLastRepeat"+(n.ngLastRepeat?"."+n.ngLastRepeat:""))})}}}]),angular.module("lukkari.directives").directive("timeRange",[function(){return{template:["{{lesson.startDay.toLocaleTimeString","(",navigator.language,', {hour:"numeric", minute:"numeric"})}}'," â€” {{lesson.endDay.toLocaleTimeString","(",navigator.language,', {hour:"numeric", minute:"numeric"})}}'].join("")}}]),angular.module("lukkari.controllers").controller("LessonCtrl",["$scope","$stateParams","Lessons","ionicMaterialInk",function(e,t,a,n){e.lesson=a.getLesson(t.id),n.displayEffect()}]),angular.module("lukkari.controllers").controller("LukkariCtrl",["$scope",function(e){}]),angular.module("lukkari.controllers").controller("LunchCtrl",["$scope","FoodService","ionicMaterialInk","ionicMaterialMotion","$ionicLoading",function(e,t,a,n,o){o.show({templateUrl:"templates/loading.html"}),t.get({callback:function(t){e.lunches=t,o.hide()}}),e.$on("ngLastRepeat.myList",function(e){n.ripple()}),a.displayEffect()}]),angular.module("lukkari.controllers").controller("RealizationCtrl",["$scope","$stateParams","Search","ionicMaterialInk",function(e,t,a,n){var o={codes:[t.code],successCallback:function(t){e.realization=t.realizations[0],e.realization.startDate=new Date(e.realization.startDate),e.realization.endDate=new Date(e.realization.endDate),e.realization.enrollmentStart=new Date(e.realization.enrollmentStart),e.realization.enrollmentEnd=new Date(e.realization.enrollmentEnd)},errorCallback:function(e){}};e.realization=a.search(o),n.displayEffect()}]),angular.module("lukkari.controllers").controller("SearchCtrl",["$scope","Search","$ionicLoading","$ionicModal","ionicMaterialInk","ionicMaterialMotion","$cordovaToast",function(e,t,a,n,o,r,i){e.searchParams={successCallback:function(t){t.realizations.length<1e3?(e.realizations=t.realizations,e.realizations.forEach(function(e){e.startDate=new Date(e.startDate),e.endDate=new Date(e.endDate)})):i.show(i18n.t("search.please_enter_parameters"),"long","center"),a.hide()},errorCallback:function(e){}},n.fromTemplateUrl("templates/searchModal.html",{scope:e}).then(function(t){return e.modal=t}),e.close=function(){return e.modal.hide()},e.openSearch=function(){return e.modal.show()},e.search=function(){e.modal.hide(),a.show({templateUrl:"templates/loading.html"}),void 0!==e.searchParams.code&&null!==e.searchParams.code&&(e.searchParams.codes=[e.searchParams.code]),void 0!==e.searchParams.studentGroup&&null!==e.searchParams.studentGroup&&""!==e.searchParams.studentGroup&&(e.searchParams.studentGroups=[e.searchParams.studentGroup.toUpperCase()]),t.search(e.searchParams)},e.$on("ngLastRepeat.myList",function(e){return r.blinds()}),o.displayEffect()}]),angular.module("lukkari.controllers").controller("SettingsCtrl",["$scope","LocalStorage","$cordovaToast","$ionicPlatform","$timeout","$cordovaCalendar","Lessons","MyDate","ionicMaterialInk","ionicMaterialMotion","$cordovaLocalNotification","Notifications",function(e,t,a,n,o,r,i,s,l,c,u,d){e.groupInfo={group:t.get({key:"groupName"})},e.groupInfo.group||(e.groupInfo.group=""),e.reminder={startDay:new Date,endDay:new Date,time:"null"},e.notification={use:t.get({key:"useNotification"}),time:null},e.notification.use||(e.notification.use=!1);var p={duration:"long",position:"center"};e.datepickerObject={titleLabel:i18n.t("settings.select_start_date"),todayLabel:i18n.t("settings.today"),closeLabel:'<span class="icon ion-android-close"></span>',setLabel:'<span class="icon ion-android-done"></span>',setButtonType:"button-positive",todayButtonType:"button-stable",closeButtonType:"button-assertive",inputDate:e.reminder.startDay,mondayFirst:!0,templateType:"popup",showTodayButton:"true",modalHeaderColor:"bar-stable",modalFooterColor:"bar-stable",from:new Date,callback:function(t){"undefined"==typeof t||(e.reminder.startDay=t,e.datepickerObject.inputDate=t)},dateFormat:"dd-MM-yyyy",closeOnSelect:!0},e.datepickerObject2={titleLabel:i18n.t("settings.select_end_date"),todayLabel:i18n.t("settings.select_start_date"),closeLabel:'<span class="icon ion-android-close"></span>',setLabel:'<span class="icon ion-android-done"></span>',setButtonType:"button-positive",todayButtonType:"button-stable",closeButtonType:"button-assertive",inputDate:e.reminder.endDay,mondayFirst:!0,templateType:"popup",showTodayButton:!1,modalHeaderColor:"bar-positive",modalFooterColor:"bar-positive",from:new Date,callback:function(t){"undefined"==typeof t||(e.reminder.endDay=t,e.datepickerObject2.inputDate=t)},dateFormat:"dd-MM-yyyy",closeOnSelect:!0},e.changeGroup=function(){t.set({key:"groupName",value:e.groupInfo.group}),n.ready(function(){a.show(i18n.t("settings.group_change_successful"),p.duration,p.position),o(function(){return window.location.href="#/app/today"},2e3)})},e.setNotification=function(){d.useNotifications({use:e.notification.use,timeOffset:-e.notification.time})},e.addToCalendar=function(){function t(e,t,a){for(var n="",i=0;i<e.groups.length;i++)n+=e.groups[i]+", ";var l=[i18n.t("settings.course_name"),e.code,"\n",i18n.t("settings.group"),n].join("");r.createEventWithOptions({title:e.name,location:e.room,notes:l,startDate:e.startDay,endDate:e.endDay,firstReminderMinutes:o.firstReminderMinutes,secondReminderMinutes:o.secondReminderMinutes,calendarName:o.calendarName,calendarId:o.calendarId}).then(function(e){},function(e){s=!1})}var o={calendarName:i18n.t("settings.calendar_name"),calendarId:1};"null"!==e.reminder.time?o.firstReminderMinutes=e.reminder.time:o.firstReminderMinutes=null,o.secondReminderMinutes=null;var s=!0;i.getDayToDay({startDate:e.reminder.startDay,endDate:e.reminder.endDay,callback:function(e){n.ready(function(){return e.lessons.forEach(t)})}});var l="";l=s?i18n.t("settings.success_message"):i18n.t("settings.failure_message"),a.show(l,p.duration,p.position)},c.ripple(),l.displayEffect()}]),angular.module("lukkari.controllers").controller("TodayCtrl",["$scope","$ionicLoading","LocalStorage","$ionicModal","MyDate","Lessons","ionicMaterialInk","ionicMaterialMotion","Notifications",function(e,t,a,n,o,r,i,s,l){function c(){t.show({templateUrl:"templates/loading.html"}),r.getDay({day:e.currentDay,callback:function(a){t.hide(),a.success&&(e.lessons=a.dayLessons)}})}e.groupInfo={group:a.get({key:"groupName"})},e.currentDay=new Date;var u=a.get({key:"useNotification"});1==u&&l.useNotifications({use:e.notification.use,timeOffset:-e.notification.time}),n.fromTemplateUrl("templates/newgroup.html",{scope:e}).then(function(t){e.modal=t,e.groupInfo.group||("undefined"!=typeof AdMob&&AdMob.hideBanner(),e.modal.show())}),e.closeGroupName=function(){e.modal.hide(),"undefined"!=typeof AdMob&&AdMob.showBanner(AdMob.AD_POSITION.BOTTOM_CENTER)},e.$on("ngLastRepeat.myList",function(e){return s.blinds()}),e.setGroup=function(){a.set({key:"groupName",value:e.groupInfo.group}),e.modal.hide(),r.changeGroup({groupName:e.groupInfo.group,callback:function(e){return e?c():void 0}})},e.lessons=[],void 0!==e.groupInfo.group&&null!==e.groupInfo.group&&r.changeGroup({groupName:e.groupInfo.group,callback:function(e){return e?c():void 0}}),e.moveDay=function(t){var n=a.get({key:"adTime"});if(n){var r=3e5,i=Date.now()-n;i>r&&("undefined"!=typeof AdMob&&AdMob.showInterstitial(),n=Date.now(),a.set({key:"adTime",value:n}))}else"undefined"!=typeof AdMob&&AdMob.showInterstitial(),n=Date.now(),a.set({key:"adTime",value:n});e.currentDay=o.getDayFromDay({currentDay:e.currentDay,offsetDays:t}),c()},i.displayEffect()}]),angular.module("lukkari.controllers").controller("WeekCtrl",["$scope","$ionicLoading","$ionicModal","LocalStorage","MyDate","Lessons","ionicMaterialInk","ionicMaterialMotion",function(e,t,a,n,o,r,i,s){function l(){t.show({templateUrl:"templates/loading.html"}),r.getWeek({day:e.currentDate,callback:function(a){if(a.success){var n=a.weekLessons;e.days=[];for(var r=0;5>r;r++){var i={};i.date=o.getDayFromDay({currentDay:e.currentDate,offsetDays:r}),i.lessons=[];for(var s=n.length,l=0;s>l;l++){var c=n[l];c.startDay.toDateString()===i.date.toDateString()&&i.lessons.push(c)}e.days.push(i)}}else t.hide()}})}e.groupInfo={group:n.get({key:"groupName"})},e.currentDate=o.getMonday(new Date),e.endDate=o.getDayFromDay({currentDay:e.currentDate,offsetDays:4}),e.groupInfo.group||a.fromTemplateUrl("templates/newgroup.html",{scope:e}).then(function(t){e.modal=t,e.modal.show()}),e.closeGroupName=function(){return e.modal.hide()},e.$on("ngLastRepeat.myList",function(e){t.hide(),s.ripple()}),e.setGroup=function(){n.set({key:"groupName",value:e.groupInfo.group}),e.modal.hide(),r.changeGroup({groupName:e.groupInfo.group,callback:function(e){return e?l():void 0}})},e.lessons=[],void 0!==e.groupInfo.group&&r.changeGroup({groupName:e.groupInfo.group,callback:function(e){return e?l():void 0}}),e.moveWeek=function(t){e.currentDate=o.getDayFromDay({currentDay:e.currentDate,offsetDays:7*t}),e.endDate=o.getDayFromDay({currentDay:e.currentDate,offsetDays:4}),l()},i.displayEffect()}]);
//# sourceMappingURL=bundle.min.js.map
